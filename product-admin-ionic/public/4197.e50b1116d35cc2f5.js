"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4197],{4197:(B,v,d)=>{d.r(v),d.d(v,{HomePageModule:()=>X});var g=d(177),l=d(4341),a=d(4488),h=d(4964),u=d(467),e=d(4438),P=d(4714),b=d(1491),k=d(9381),y=d(3683);function I(o,r){if(1&o&&(e.j41(0,"ion-avatar"),e.nrm(1,"img",11),e.k0s()),2&o){const i=e.XpG();e.R7$(),e.Y8G("src",i.form.value.image,e.B4B)}}function F(o,r){1&o&&e.nrm(0,"ion-icon",12)}function U(o,r){1&o&&(e.j41(0,"div"),e.EFF(1,"Este campo es requerido"),e.k0s())}function T(o,r){1&o&&(e.j41(0,"div"),e.EFF(1,"El nombre debe tener al menos 4 caracteres"),e.k0s())}function S(o,r){if(1&o&&(e.j41(0,"div",13),e.DNE(1,U,2,0,"div",2)(2,T,2,0,"div",2),e.k0s()),2&o){const i=e.XpG();e.R7$(),e.Y8G("ngIf",null==i.form.controls.name.errors?null:i.form.controls.name.errors.required),e.R7$(),e.Y8G("ngIf",null==i.form.controls.name.errors?null:i.form.controls.name.errors.minlenght)}}function C(o,r){1&o&&(e.j41(0,"div"),e.EFF(1,"Este campo es requerido"),e.k0s())}function $(o,r){if(1&o&&(e.j41(0,"div",13),e.DNE(1,C,2,0,"div",2),e.k0s()),2&o){const i=e.XpG();e.R7$(),e.Y8G("ngIf",null==i.form.controls.price.errors?null:i.form.controls.price.errors.required)}}function G(o,r){1&o&&(e.j41(0,"div"),e.EFF(1,"Este campo es requerido"),e.k0s())}function R(o,r){if(1&o&&(e.j41(0,"div",13),e.DNE(1,G,2,0,"div",2),e.k0s()),2&o){const i=e.XpG();e.R7$(),e.Y8G("ngIf",null==i.form.controls.soldUnits.errors?null:i.form.controls.soldUnits.errors.required)}}let j=(()=>{var o;class r{constructor(){this.form=new l.gE({id:new l.MJ(""),image:new l.MJ("",[l.k0.required]),name:new l.MJ("",[l.k0.required,l.k0.minLength(4)]),price:new l.MJ("",[l.k0.required,l.k0.minLength(4)]),soldUnits:new l.MJ(null,[l.k0.required,l.k0.min(0)])}),this.firebaseSvc=(0,e.WQX)(P.f),this.utilsSvc=(0,e.WQX)(b.T),this.user={}}ngOnInit(){this.user=this.utilsSvc.getFromLocalStorage("user"),this.product&&this.form.setValue(this.product)}takeImage(){var t=this;return(0,u.A)(function*(){const n=(yield t.utilsSvc.takePicture("imagen del producto")).dataUrl;t.form.controls.image.setValue(n)})()}submit(){this.form.valid&&(this.product?this.updateProduct():this.createProduct())}setNumbreInputs(){let{soldUnits:t}=this.form.controls;t.value&&t.setValue(parseFloat(t.value))}createProduct(){var t=this;return(0,u.A)(function*(){let n=`users/${t.user.uid}/products`;const s=yield t.utilsSvc.loading();yield s.present();let c=t.form.value.image,p=`${t.user.uid}/${Date.now()}`,m=yield t.firebaseSvc.uploadImage(p,c);t.form.controls.image.setValue(m),delete t.form.value.id,t.firebaseSvc.addDocument(n,t.form.value).then(function(){var f=(0,u.A)(function*(_){t.utilsSvc.dismissModal({success:!0}),t.utilsSvc.presentToast({message:"Opini\xf3n guardada exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"})});return function(_){return f.apply(this,arguments)}}()).catch(f=>{console.log(f),t.utilsSvc.presentToast({message:f.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{s.dismiss()})})()}updateProduct(){var t=this;return(0,u.A)(function*(){let n=`users/${t.user.uid}/products/${t.product.id}`;const s=yield t.utilsSvc.loading();if(yield s.present(),t.form.value.image!==t.product.image){let c=t.form.value.image,p=yield t.firebaseSvc.getFilePath(t.product.image),m=yield t.firebaseSvc.uploadImage(p,c);t.form.controls.image.setValue(m)}delete t.form.value.id,t.firebaseSvc.updateDocument(n,t.form.value).then(function(){var c=(0,u.A)(function*(p){t.utilsSvc.dismissModal({success:!0}),t.utilsSvc.presentToast({message:"Producto actualizado exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"})});return function(p){return c.apply(this,arguments)}}()).catch(c=>{console.log(c),t.utilsSvc.presentToast({message:c.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{s.dismiss()})})()}}return(o=r).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.VBU({type:o,selectors:[["app-add-update-product"]],inputs:{product:"product"},decls:17,vars:13,consts:[[3,"isModal","title"],[1,"ion-padding","ion-text-center",3,"ngSubmit","keypress.enter","formGroup"],[4,"ngIf"],["class","image-icon","name","image-outline",4,"ngIf"],["mode","ios","size","small","shape","round",3,"click"],["autocomplete","name","type","text","label","Nombre",3,"control"],["class","validators",4,"ngIf"],["type","text","label","Comentario",3,"ionInput","control"],["type","number","label","Calif\xedcanos (1-10)",3,"ionInput","control"],["mode","ios","type","submit",1,"ion-margin",3,"disabled"],["slot","end","name","checkmark-circle-outline"],[3,"src"],["name","image-outline",1,"image-icon"],[1,"validators"]],template:function(t,n){1&t&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content")(2,"form",1),e.bIt("ngSubmit",function(){return n.submit()})("keypress.enter",function(){return n.submit()}),e.DNE(3,I,2,1,"ion-avatar",2)(4,F,1,0,"ion-icon",3),e.nrm(5,"br"),e.j41(6,"ion-button",4),e.bIt("click",function(){return n.takeImage()}),e.EFF(7," Tomar/seleccionar foto "),e.k0s(),e.nrm(8,"app-custom-input",5),e.DNE(9,S,3,2,"div",6),e.j41(10,"app-custom-input",7),e.bIt("ionInput",function(){return n.setNumbreInputs()}),e.k0s(),e.DNE(11,$,2,1,"div",6),e.j41(12,"app-custom-input",8),e.bIt("ionInput",function(){return n.setNumbreInputs()}),e.k0s(),e.DNE(13,R,2,1,"div",6),e.j41(14,"ion-button",9),e.EFF(15),e.nrm(16,"ion-icon",10),e.k0s()()()),2&t&&(e.Y8G("isModal",!0)("title",n.product?"Actualizar opini\xf3n":"Agregar opini\xf3n"),e.R7$(2),e.Y8G("formGroup",n.form),e.R7$(),e.Y8G("ngIf",n.form.value.image),e.R7$(),e.Y8G("ngIf",!n.form.value.image),e.R7$(4),e.Y8G("control",n.form.controls.name),e.R7$(),e.Y8G("ngIf",n.form.controls.name.errors&&n.form.controls.name.touched),e.R7$(),e.Y8G("control",n.form.controls.price),e.R7$(),e.Y8G("ngIf",n.form.controls.price.errors&&n.form.controls.price.touched),e.R7$(),e.Y8G("control",n.form.controls.soldUnits),e.R7$(),e.Y8G("ngIf",n.form.controls.soldUnits.errors&&n.form.controls.soldUnits.touched),e.R7$(),e.Y8G("disabled",n.form.invalid),e.R7$(),e.SpI(" ",n.product?"Actualizar comentario":"Agregar comentario"," "))},dependencies:[g.bT,a.mC,a.Jm,a.W9,a.iq,l.qT,l.cb,l.j4,k.l,y.H],styles:[".image-icon[_ngcontent-%COMP%]{font-size:100px;opacity:30%}ion-avatar[_ngcontent-%COMP%]{width:200px;height:160px;--border-radius: 15px;margin:0 auto}"]}),r})();var A=d(2784);const E=()=>[1,1,1,1,1,1,1,1];function M(o,r){if(1&o){const i=e.RV6();e.j41(0,"ion-item-sliding",8)(1,"ion-item")(2,"ion-avatar",9),e.nrm(3,"img",10),e.k0s(),e.j41(4,"ion-label")(5,"div",11),e.EFF(6),e.k0s(),e.j41(7,"div",12)(8,"strong"),e.EFF(9,"Comentario: "),e.k0s(),e.EFF(10),e.nrm(11,"br"),e.j41(12,"strong"),e.EFF(13,"Calificaci\xf3n: "),e.k0s(),e.EFF(14),e.k0s()()(),e.j41(15,"ion-item-options")(16,"ion-item-option",5),e.bIt("click",function(){const n=e.eBV(i).$implicit,s=e.XpG(2);return e.Njj(s.addUpdateProduct(n))}),e.nrm(17,"ion-icon",13),e.k0s(),e.j41(18,"ion-item-option",14),e.bIt("click",function(){const n=e.eBV(i).$implicit,s=e.XpG(2);return e.Njj(s.confirmDeleteProduct(n))}),e.nrm(19,"ion-icon",15),e.k0s()()()}if(2&o){const i=r.$implicit;e.R7$(3),e.Y8G("src",i.image,e.B4B),e.R7$(3),e.JRh(i.name),e.R7$(4),e.SpI("",i.price," "),e.R7$(4),e.SpI("",i.soldUnits," ")}}function H(o,r){if(1&o&&(e.j41(0,"ion-list"),e.DNE(1,M,20,4,"ion-item-sliding",7),e.k0s()),2&o){const i=e.XpG();e.R7$(),e.Y8G("ngForOf",i.products)}}function Y(o,r){1&o&&(e.j41(0,"ion-item",8)(1,"ion-avatar",9),e.nrm(2,"ion-skeleton-text",16),e.k0s(),e.j41(3,"ion-label")(4,"div"),e.nrm(5,"ion-skeleton-text",17),e.k0s(),e.j41(6,"div"),e.nrm(7,"ion-skeleton-text",18),e.k0s()()())}function x(o,r){1&o&&(e.j41(0,"ion-list"),e.DNE(1,Y,8,0,"ion-item",7),e.k0s()),2&o&&(e.R7$(),e.Y8G("ngForOf",e.lJ4(1,E)))}function D(o,r){1&o&&(e.j41(0,"div",19),e.nrm(1,"ion-icon",20),e.j41(2,"h3"),e.EFF(3,"No hay opiniones disponibles"),e.k0s()())}const N=[{path:"",component:(()=>{var o;class r{constructor(){this.firebaseSvc=(0,e.WQX)(P.f),this.utilsSvc=(0,e.WQX)(b.T),this.products=[],this.loading=!1}ngOnInit(){}user(){return this.utilsSvc.getFromLocalStorage("user")}ionViewWillEnter(){this.getProducts()}doRefresh(t){setTimeout(()=>{this.getProducts(),t.target.complete()},1e3)}getProfits(){return this.products.reduce((t,n)=>t+n.soldUnits,0)}getProducts(){let t=`users/${this.user().uid}/products`;this.loading=!0;let n=[(0,A.My)("soldUnits","desc")],s=this.firebaseSvc.getCollectionData(t,n).subscribe({next:c=>{console.log(c),this.products=c,this.loading=!1,s.unsubscribe()}})}addUpdateProduct(t){var n=this;return(0,u.A)(function*(){(yield n.utilsSvc.presentModal({component:j,cssClass:"add-update-modal",componentProps:{product:t}}))&&n.getProducts()})()}confirmDeleteProduct(t){var n=this;return(0,u.A)(function*(){n.utilsSvc.presentAlert({header:"Eliminar opini\xf3n",message:"Quieres eliminar esta opini\xf3n?",mode:"ios",buttons:[{text:"Cancelar"},{text:"Si, eliminar",handler:()=>{n.deleteProduct(t)}}]})})()}deleteProduct(t){var n=this;return(0,u.A)(function*(){let s=`users/${n.user().uid}/products/${t.id}`;const c=yield n.utilsSvc.loading();yield c.present();let p=yield n.firebaseSvc.getFilePath(t.image);yield n.firebaseSvc.deleteFile(p),n.firebaseSvc.deleteDocument(s).then(function(){var m=(0,u.A)(function*(f){n.products=n.products.filter(_=>_.id!==t.id),n.utilsSvc.presentToast({message:"Opini\xf3n eliminada exitosamente",duration:1500,color:"success",position:"middle",icon:"checkmark-circle-outline"})});return function(f){return m.apply(this,arguments)}}()).catch(m=>{console.log(m),n.utilsSvc.presentToast({message:m.message,duration:2500,color:"primary",position:"middle",icon:"alert-circle-outline"})}).finally(()=>{c.dismiss()})})()}}return(o=r).\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.VBU({type:o,selectors:[["app-home"]],decls:10,vars:4,consts:[["title","Opiniones",3,"showMenu"],["slot","fixed",3,"ionRefresh"],[4,"ngIf"],["class","empty",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],[3,"click"],["name","add"],["class","product-item",4,"ngFor","ngForOf"],[1,"product-item"],["slot","start"],[3,"src"],[1,"name"],[1,"data"],["name","create-outline",1,"option-btn"],["color","danger",3,"click"],["name","trash-outline",1,"option-btn"],["animated","",2,"width","100%","height","100%"],["animated","",2,"width","50%"],["animated","",2,"width","30%"],[1,"empty"],["name","shield-outline"]],template:function(t,n){1&t&&(e.nrm(0,"app-header",0),e.j41(1,"ion-content")(2,"ion-refresher",1),e.bIt("ionRefresh",function(c){return n.doRefresh(c)}),e.nrm(3,"ion-refresher-content"),e.k0s(),e.DNE(4,H,2,1,"ion-list",2)(5,x,2,2,"ion-list",2)(6,D,4,0,"div",3),e.j41(7,"ion-fab",4)(8,"ion-fab-button",5),e.bIt("click",function(){return n.addUpdateProduct()}),e.nrm(9,"ion-icon",6),e.k0s()()()),2&t&&(e.Y8G("showMenu",!0),e.R7$(4),e.Y8G("ngIf",!n.loading),e.R7$(),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",!n.loading&&!n.products.length))},dependencies:[g.Sq,g.bT,a.mC,a.W9,a.Q8,a.YW,a.iq,a.uz,a.LU,a.CE,a.A7,a.he,a.nf,a.To,a.Ki,a.ds,k.l],styles:["ion-card[_ngcontent-%COMP%]{gap:80px;padding:20px 0;border-radius:15px}ion-content[_ngcontent-%COMP%]{--padding-bottom: 70px}"]}),r})()}];let O=(()=>{var o;class r{}return(o=r).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[h.iI.forChild(N),h.iI]}),r})();var V=d(3887);let X=(()=>{var o;class r{}return(o=r).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[g.MD,l.YN,a.bv,O,V.G]}),r})()}}]);